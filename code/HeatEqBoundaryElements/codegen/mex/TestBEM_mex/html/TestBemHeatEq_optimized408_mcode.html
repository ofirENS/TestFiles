<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="136,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T45U3">u</span>,<span class="var type1" id="S3T37U4">r</span>]= TestBemHeatEq_optimized(<span class="var type1" id="S4T2U7">sigIn</span>,<span class="var type1" id="S5T1U8">regOrder</span>,<span class="var type1" id="S6T1U9">lambda</span>,<span class="var type1" id="S7T3U10">plotFlag</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="136,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Solve the inveerse heat equation with an unknown source</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% u_t(x,t) = ku_{xx}(x,y) +r(t)*f(x,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% with 0&lt;=x&lt;=1, 0&lt;=t&lt;=T</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% subject to the boundary conditions u(0,t) = u(1,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% and u_x(0,t)+alpha*u(0,t)=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% and initial condition</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% u(x,0) = phi(x) =u0, 0&lt;=x&lt;=1</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% In this problem we take f(x,t) =1 for all x and t</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,11" id="srcline11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% The convention for most matrices is that rows are time, columns are space</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo" id="T1:U7"><span class="var type1" id="S8T1U13">alpha</span>    = <span class="mxinfo" id="T1:U9">-1</span></span>; <span class="comment">% for the boundary condition</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% lambda   = 1.7; % regularization constant (affects smoothness of source solution)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% regOrder = 2;  % Tikhonov regularization term order, [0,1,or 2]</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% if ~exist('sigIn','var')</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%     N0     = 3;   % space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%     N      = 150; % time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%     % test signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%     sigIn      = (3*cos((1:N) *pi/8)./N+0.5*randn(1,N));% a vector of N points is the integral of the solution over the space</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%     E          = sigIn;</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,24" id="srcline24"> 24</a></span><span class="line">    <span class="mxinfo" id="T1:U10"><span class="var type1" id="S9T1U18">N0</span> = <span class="mxinfo" id="T1:U12">3</span></span>;        <span class="comment">% space points;</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,25" id="srcline25"> 25</a></span><span class="line">    <span class="mxinfo" id="T2:U13"><span class="var type1" id="S10T2U22">E</span>  = (<span class="var type1" id="S4T2U24">sigIn</span>)</span>;  <span class="comment">% int(u(x,t)dx) is a time function of size 1xN</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,26" id="srcline26"> 26</a></span><span class="line">    <span class="mxinfo" id="T1:U16"><span class="var type1" id="S11T1U27">N</span>  = <span class="mxinfo" id="T1:U18">numel(<span class="var type1" id="S10T2U30">E</span>)</span></span>; <span class="comment">% time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T45:U20"><span class="var type1" id="S13T45U33">f</span>      = <span class="mxinfo" id="T45:U22"><span class="mxinfo" id="T1:U23">1</span>*<span class="mxinfo" id="T45:U24">ones(<span class="var type1" id="S11T1U38">N</span>,<span class="mxinfo" id="T1:U26"><span class="var type1" id="S9T1U39">N0</span></span>)</span></span></span>; <span class="comment">% function of N time points over N0 space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo" id="T47:U28"><span class="var type1" id="S15T47U42">u0</span>     = <span class="mxinfo" id="T47:U30"><span class="mxinfo" id="T1:U31">max(<span class="mxinfo" id="T46:U32"><span class="var type1" id="S10T2U47">E</span>(<span class="mxinfo" id="T46:U34"><span class="mxinfo" id="T1:U35">1</span>:<span class="mxinfo" id="T1:U36">10</span></span>)</span>)</span>*<span class="mxinfo" id="T47:U37">ones(1,<span class="var type1" id="S9T1U54">N0</span>)</span></span></span>; <span class="comment">% is the phi function</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% Discretize the time and space domain</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T1:U39"><span class="var type1" id="S17T1U57">T</span>      = <span class="mxinfo" id="T1:U41">numel(<span class="var type1" id="S10T2U60">E</span>)</span></span>;         <span class="comment">% max time;</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T2:U43"><span class="var type1" id="S18T2U63">gridT</span>  = <span class="mxinfo" id="T2:U45">(<span class="mxinfo" id="T2:U46">0:(<span class="var type1" id="S11T1U69">N</span>)</span>).*(<span class="mxinfo" id="T1:U48"><span class="var type1" id="S17T1U72">T</span>/<span class="var type1" id="S11T1U73">N</span></span>)</span></span>;<span class="comment">% N+1 points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo" id="T2:U51"><span class="var type1" id="S19T2U76">t</span>      = <span class="mxinfo" id="T2:U53">zeros(<span class="mxinfo" id="T1:U54">1</span>,<span class="var type1" id="S11T1U80">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,35" id="srcline35"> 35</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S21T1U83">tIdx</span> = <span class="mxinfo" id="T1:U57">1</span>:<span class="var type1" id="S11T1U86">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,36" id="srcline36"> 36</a></span><span class="line">    <span class="mxinfo" id="T1:U59"><span class="mxinfo" id="T1:U60"><span class="var type1" id="S19T2U90">t</span>(<span class="var type1" id="S21T1U91">tIdx</span>)</span> = <span class="mxinfo" id="T1:U63">(<span class="mxinfo" id="T1:U64"><span class="mxinfo" id="T1:U65"><span class="var type1" id="S18T2U96">gridT</span>(<span class="var type1" id="S21T1U97">tIdx</span>)</span>+<span class="mxinfo" id="T1:U68"><span class="var type1" id="S18T2U99">gridT</span>(<span class="mxinfo" id="T1:U70"><span class="var type1" id="S21T1U101">tIdx</span>+<span class="mxinfo" id="T1:U72">1</span></span>)</span></span>)/<span class="mxinfo" id="T1:U73">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T48:U74"><span class="var type1" id="S22T48U106">gridX</span> = <span class="mxinfo" id="T48:U76">(0:(<span class="var type1" id="S9T1U112">N0</span>))./<span class="var type1" id="S9T1U113">N0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo" id="T47:U79"><span class="var type1" id="S23T47U116">x</span>     = <span class="mxinfo" id="T47:U81">zeros(<span class="mxinfo" id="T1:U82">1</span>,<span class="mxinfo" id="T1:U83"><span class="var type1" id="S9T1U120">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,40" id="srcline40"> 40</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S24T1U123">xIdx</span> = <span class="mxinfo" id="T1:U86">1</span>:numel(<span class="var type1" id="S23T47U128">x</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="136,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo" id="T1:U88"><span class="mxinfo" id="T1:U89"><span class="var type1" id="S23T47U132">x</span>(<span class="var type1" id="S24T1U133">xIdx</span>)</span> = <span class="mxinfo" id="T1:U92">(<span class="mxinfo" id="T1:U93"><span class="mxinfo" id="T1:U94"><span class="var type1" id="S22T48U138">gridX</span>(<span class="mxinfo" id="T1:U96"><span class="var type1" id="S24T1U140">xIdx</span>+<span class="mxinfo" id="T1:U98">1</span></span>)</span>+<span class="mxinfo" id="T1:U99"><span class="var type1" id="S22T48U143">gridX</span>(<span class="var type1" id="S24T1U144">xIdx</span>)</span></span>)/<span class="mxinfo" id="T1:U102">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,42" id="srcline42"> 42</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">% Determine the boundary and initial functions</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% u(0,t) = h0j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo" id="T37:U103"><span class="var type1" id="S25T37U148">h0j</span> = <span class="mxinfo" id="T37:U105">zeros(<span class="var type1" id="S11T1U151">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% u(1,t) = h1j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo" id="T37:U107"><span class="var type1" id="S26T37U155">h1j</span> = <span class="mxinfo" id="T37:U109">zeros(<span class="var type1" id="S11T1U158">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% du/dn(0,t) = q0j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo" id="T37:U111"><span class="var type1" id="S27T37U162">q0j</span> = <span class="mxinfo" id="T37:U113">zeros(<span class="var type1" id="S11T1U165">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%du/dn(1,t) = q1j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T37:U115"><span class="var type1" id="S28T37U169">q1j</span> = <span class="mxinfo" id="T37:U117">zeros(<span class="var type1" id="S11T1U172">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%===========================</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">% Calculate the matrix for the Acoeff,Bcoeff, BStar, D, C to be used later</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% for A,B,C,D</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% the spatial domain for the calculation is the [0, x, 1]</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% xPoints   = [0, x, 1]; % add boundary points to the intermidiate ones</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% Nx        = numel(xPoints);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% aCoeffMat0 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% aCoeffMat1 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% bCoeffMat0 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">% bCoeffMat1 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% for j=1:numel(xPoints)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%     for i=1:N</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%         aCoeffMat0(i,j) = Acoeff(0,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%         aCoeffMat1(i,j) = Acoeff(1,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%         bCoeffMat0(i,j) = Bcoeff(0,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%         bCoeffMat1(i,j) = Bcoeff(1,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% Calculate the Boundary Elements</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">% Calculate A and B, B*, and D</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo" id="T20:U119"><span class="var type1" id="S29T20U176">A</span>      = <span class="mxinfo" id="T20:U121">zeros(<span class="mxinfo" id="T1:U122"><span class="mxinfo" id="T1:U123">2</span>*<span class="var type1" id="S11T1U181">N</span></span>,<span class="mxinfo" id="T1:U125"><span class="mxinfo" id="T1:U126">2</span>*<span class="var type1" id="S11T1U184">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo" id="T20:U128"><span class="var type1" id="S30T20U187">B</span>      = <span class="mxinfo" id="T20:U130">zeros(<span class="mxinfo" id="T1:U131"><span class="mxinfo" id="T1:U132">2</span>*<span class="var type1" id="S11T1U192">N</span></span>,<span class="mxinfo" id="T1:U134"><span class="mxinfo" id="T1:U135">2</span>*<span class="var type1" id="S11T1U195">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo" id="T20:U137"><span class="var type1" id="S31T20U198">Bstar</span>  = <span class="mxinfo" id="T20:U139">zeros(<span class="mxinfo" id="T1:U140"><span class="mxinfo" id="T1:U141">2</span>*<span class="var type1" id="S11T1U203">N</span></span>,<span class="mxinfo" id="T1:U143"><span class="mxinfo" id="T1:U144">2</span>*<span class="var type1" id="S11T1U206">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo" id="T20:U146"><span class="var type1" id="S32T20U209">D</span>      = <span class="mxinfo" id="T20:U148">zeros(<span class="mxinfo" id="T1:U149"><span class="mxinfo" id="T1:U150">2</span>*<span class="var type1" id="S11T1U214">N</span></span>,<span class="var type1" id="S11T1U215">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,82" id="srcline82"> 82</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S33T1U218">j</span> = <span class="mxinfo" id="T1:U154">1</span>:<span class="var type1" id="S11T1U221">N</span> <span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,83" id="srcline83"> 83</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S34T1U224">i</span> = <span class="mxinfo" id="T1:U157">1</span>:<span class="var type1" id="S11T1U227">N</span> <span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,84" id="srcline84"> 84</a></span><span class="line">        <span class="mxinfo" id="T1:U159"><span class="var type1" id="S35T1U230">deltaij</span> = <span class="mxinfo" id="T1:U161">double(<span class="mxinfo" id="T3:U162"><span class="var type1" id="S34T1U234">i</span>==<span class="var type1" id="S33T1U235">j</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%         A(2*i-1:2*i,2*j-1:2*j) = [aCoeffMat0(1,i), aCoeffMat1(1,i);<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%                                   aCoeffMat0(end,i), aCoeffMat1(end,i)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,87" id="srcline87"> 87</a></span><span class="line">        <span class="mxinfo" id="T66:U165"><span class="mxinfo" id="T66:U166"><span class="var type1" id="S29T20U239">A</span>(<span class="mxinfo" id="T67:U168"><span class="mxinfo" id="T1:U169"><span class="mxinfo" id="T1:U170"><span class="mxinfo" id="T1:U171">2</span>*<span class="var type1" id="S34T1U244">i</span></span>-1</span>:2*<span class="var type1" id="S34T1U248">i</span></span>,<span class="mxinfo" id="T67:U174"><span class="mxinfo" id="T1:U175"><span class="mxinfo" id="T1:U176"><span class="mxinfo" id="T1:U177">2</span>*<span class="var type1" id="S33T1U253">j</span></span>-1</span>:2*<span class="var type1" id="S33T1U257">j</span></span>)</span> = <span class="mxinfo" id="T66:U180">[<span class="mxinfo" id="T15:U181"><span class="mxinfo" id="T1:U182"><span class="fcn" id="F1N2:B261">Acoeff</span>(<span class="mxinfo" id="T1:U183">0</span>,<span class="var type1" id="S33T1U263">j</span>,<span class="mxinfo" id="T1:U185">0</span>,<span class="mxinfo" id="T1:U186"><span class="var type1" id="S19T2U266">t</span>(<span class="var type1" id="S34T1U267">i</span>)</span>,<span class="var type1" id="S18T2U268">gridT</span>)</span>, <span class="mxinfo" id="T1:U190"><span class="fcn" id="F1N2:B270">Acoeff</span>(<span class="mxinfo" id="T1:U191">1</span>,<span class="var type1" id="S33T1U272">j</span>,<span class="mxinfo" id="T1:U193">0</span>,<span class="mxinfo" id="T1:U194"><span class="var type1" id="S19T2U275">t</span>(<span class="var type1" id="S34T1U276">i</span>)</span>,<span class="var type1" id="S18T2U277">gridT</span>)</span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo" id="T66:U165"><span class="mxinfo" id="T66:U180">                                  <span class="mxinfo" id="T15:U198"><span class="mxinfo" id="T1:U199"><span class="fcn" id="F1N2:B280">Acoeff</span>(<span class="mxinfo" id="T1:U200">0</span>,<span class="var type1" id="S33T1U282">j</span>,<span class="mxinfo" id="T1:U202">1</span>,<span class="mxinfo" id="T1:U203"><span class="var type1" id="S19T2U285">t</span>(<span class="var type1" id="S34T1U286">i</span>)</span>,<span class="var type1" id="S18T2U287">gridT</span>)</span>, <span class="mxinfo" id="T1:U207"><span class="fcn" id="F1N2:B289">Acoeff</span>(<span class="mxinfo" id="T1:U208">1</span>,<span class="var type1" id="S33T1U291">j</span>,<span class="mxinfo" id="T1:U210">1</span>,<span class="mxinfo" id="T1:U211"><span class="var type1" id="S19T2U294">t</span>(<span class="var type1" id="S34T1U295">i</span>)</span>,<span class="var type1" id="S18T2U296">gridT</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,89" id="srcline89"> 89</a></span><span class="line">        <span class="comment">% temp terms</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,90" id="srcline90"> 90</a></span><span class="line">        <span class="mxinfo" id="T1:U215"><span class="var type1" id="S38T1U299">b1j0i</span> = <span class="mxinfo" id="T1:U217"><span class="fcn" id="F75N4:B301">Bcoeff</span>(<span class="mxinfo" id="T1:U218">1</span>,<span class="var type1" id="S33T1U303">j</span>,<span class="mxinfo" id="T1:U220">0</span>,<span class="mxinfo" id="T1:U221"><span class="var type1" id="S19T2U306">t</span>(<span class="var type1" id="S34T1U307">i</span>)</span>,<span class="var type1" id="S18T2U308">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,91" id="srcline91"> 91</a></span><span class="line">        <span class="mxinfo" id="T1:U225"><span class="var type1" id="S40T1U311">b1j1i</span> = <span class="mxinfo" id="T1:U227"><span class="fcn" id="F75N4:B313">Bcoeff</span>(<span class="mxinfo" id="T1:U228">1</span>,<span class="var type1" id="S33T1U315">j</span>,<span class="mxinfo" id="T1:U230">1</span>,<span class="mxinfo" id="T1:U231"><span class="var type1" id="S19T2U318">t</span>(<span class="var type1" id="S34T1U319">i</span>)</span>,<span class="var type1" id="S18T2U320">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,92" id="srcline92"> 92</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,93" id="srcline93"> 93</a></span><span class="line">        <span class="mxinfo" id="T66:U235"><span class="mxinfo" id="T66:U236"><span class="var type1" id="S30T20U324">B</span>(<span class="mxinfo" id="T67:U238"><span class="mxinfo" id="T1:U239"><span class="mxinfo" id="T1:U240"><span class="mxinfo" id="T1:U241">2</span>*<span class="var type1" id="S34T1U329">i</span></span>-1</span>:2*<span class="var type1" id="S34T1U333">i</span></span>,<span class="mxinfo" id="T67:U244"><span class="mxinfo" id="T1:U245"><span class="mxinfo" id="T1:U246"><span class="mxinfo" id="T1:U247">2</span>*<span class="var type1" id="S33T1U338">j</span></span>-1</span>:2*<span class="var type1" id="S33T1U342">j</span></span>)</span> = <span class="mxinfo" id="T66:U250">[<span class="mxinfo" id="T15:U251"><span class="mxinfo" id="T1:U252"><span class="mxinfo" id="T1:U253"><span class="fcn" id="F75N4:B347">Bcoeff</span>(<span class="mxinfo" id="T1:U254">0</span>,<span class="var type1" id="S33T1U349">j</span>,<span class="mxinfo" id="T1:U256">0</span>,<span class="mxinfo" id="T1:U257"><span class="var type1" id="S19T2U352">t</span>(<span class="var type1" id="S34T1U353">i</span>)</span>,<span class="var type1" id="S18T2U354">gridT</span>)</span>+<span class="mxinfo" id="T1:U261"><span class="mxinfo" id="T1:U262">0.5</span>*<span class="var type1" id="S35T1U357">deltaij</span></span></span>, <span class="var type1" id="S38T1U358">b1j0i</span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo" id="T66:U235"><span class="mxinfo" id="T66:U250">                                  <span class="mxinfo" id="T15:U265"><span class="mxinfo" id="T1:U266"><span class="fcn" id="F75N4:B361">Bcoeff</span>(<span class="mxinfo" id="T1:U267">0</span>,<span class="var type1" id="S33T1U363">j</span>,<span class="mxinfo" id="T1:U269">1</span>,<span class="mxinfo" id="T1:U270"><span class="var type1" id="S19T2U366">t</span>(<span class="var type1" id="S34T1U367">i</span>)</span>,<span class="var type1" id="S18T2U368">gridT</span>)</span>, <span class="mxinfo" id="T1:U274"><span class="var type1" id="S40T1U370">b1j1i</span>+<span class="mxinfo" id="T1:U276"><span class="mxinfo" id="T1:U277">0.5</span>*<span class="var type1" id="S35T1U373">deltaij</span></span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,95" id="srcline95"> 95</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,96" id="srcline96"> 96</a></span><span class="line">        <span class="mxinfo" id="T66:U279"><span class="mxinfo" id="T66:U280"><span class="var type1" id="S31T20U377">Bstar</span>(<span class="mxinfo" id="T67:U282"><span class="mxinfo" id="T1:U283"><span class="mxinfo" id="T1:U284"><span class="mxinfo" id="T1:U285">2</span>*<span class="var type1" id="S34T1U382">i</span></span>-1</span>:2*<span class="var type1" id="S34T1U386">i</span></span>,<span class="mxinfo" id="T67:U288"><span class="mxinfo" id="T1:U289"><span class="mxinfo" id="T1:U290"><span class="mxinfo" id="T1:U291">2</span>*<span class="var type1" id="S33T1U391">j</span></span>-1</span>:2*<span class="var type1" id="S33T1U395">j</span></span>)</span> = <span class="mxinfo" id="T66:U294">[<span class="mxinfo" id="T15:U295"><span class="var type1" id="S38T1U398">b1j0i</span>,            <span class="mxinfo" id="T1:U297">-<span class="var type1" id="S38T1U400">b1j0i</span></span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo" id="T66:U279"><span class="mxinfo" id="T66:U294">                                      <span class="mxinfo" id="T15:U299"><span class="mxinfo" id="T1:U300"><span class="var type1" id="S40T1U403">b1j1i</span>+<span class="mxinfo" id="T1:U302"><span class="var type1" id="S35T1U405">deltaij</span>/<span class="mxinfo" id="T1:U304">2</span></span></span>, <span class="mxinfo" id="T1:U305"><span class="mxinfo" id="T1:U306">-<span class="var type1" id="S40T1U409">b1j1i</span></span>-<span class="mxinfo" id="T1:U308"><span class="mxinfo" id="T1:U309">0.5</span>*<span class="var type1" id="S35T1U412">deltaij</span></span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,98" id="srcline98"> 98</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,99" id="srcline99"> 99</a></span><span class="line">        <span class="mxinfo" id="T67:U311"><span class="mxinfo" id="T67:U312"><span class="var type1" id="S32T20U416">D</span>(<span class="mxinfo" id="T67:U314"><span class="mxinfo" id="T1:U315"><span class="mxinfo" id="T1:U316"><span class="mxinfo" id="T1:U317">2</span>*<span class="var type1" id="S34T1U421">i</span></span>-1</span>:2*<span class="var type1" id="S34T1U425">i</span></span>,<span class="var type1" id="S33T1U426">j</span>)</span>=<span class="mxinfo" id="T67:U321">[<span class="mxinfo" id="T1:U322">Dcoeff(<span class="var type1" id="S23T47U431">x</span>,<span class="var type1" id="S33T1U432">j</span>,<span class="mxinfo" id="T1:U325">0</span>,<span class="mxinfo" id="T1:U326"><span class="var type1" id="S19T2U435">t</span>(<span class="var type1" id="S34T1U436">i</span>)</span>,<span class="var type1" id="S18T2U437">gridT</span>,<span class="mxinfo" id="T47:U330"><span class="var type1" id="S13T45U439">f</span>(<span class="var type1" id="S34T1U440">i</span>,:)</span>)</span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo" id="T67:U311"><span class="mxinfo" id="T67:U321">                        <span class="mxinfo" id="T1:U333">Dcoeff(<span class="var type1" id="S23T47U445">x</span>,<span class="var type1" id="S33T1U446">j</span>,<span class="mxinfo" id="T1:U336">1</span>,<span class="mxinfo" id="T1:U337"><span class="var type1" id="S19T2U449">t</span>(<span class="var type1" id="S34T1U450">i</span>)</span>,<span class="var type1" id="S18T2U451">gridT</span>,<span class="mxinfo" id="T47:U341"><span class="var type1" id="S13T45U453">f</span>(<span class="var type1" id="S34T1U454">i</span>,:)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,101" id="srcline101">101</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,102" id="srcline102">102</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,104" id="srcline104">104</a></span><span class="line"><span class="comment">% Calculate C</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo" id="T45:U344"><span class="var type1" id="S42T45U458">C</span> = <span class="mxinfo" id="T45:U346">zeros(<span class="mxinfo" id="T1:U347"><span class="mxinfo" id="T1:U348">2</span>*<span class="var type1" id="S11T1U463">N</span></span>,<span class="mxinfo" id="T1:U350"><span class="var type1" id="S9T1U464">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,106" id="srcline106">106</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S43T1U467">k</span> = <span class="mxinfo" id="T1:U353">1</span>:<span class="var type1" id="S9T1U470">N0</span><span class="comment">% space</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,107" id="srcline107">107</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S34T1U473">i</span>=<span class="mxinfo" id="T1:U356">1</span>:<span class="var type1" id="S11T1U476">N</span><span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,108" id="srcline108">108</a></span><span class="line">        <span class="mxinfo" id="T67:U358"><span class="mxinfo" id="T67:U359"><span class="var type1" id="S42T45U480">C</span>(<span class="mxinfo" id="T67:U361"><span class="mxinfo" id="T1:U362"><span class="mxinfo" id="T1:U363"><span class="mxinfo" id="T1:U364">2</span>*<span class="var type1" id="S34T1U485">i</span></span>-1</span>:2*<span class="var type1" id="S34T1U489">i</span></span>,<span class="var type1" id="S43T1U490">k</span>)</span> = <span class="mxinfo" id="T67:U368">[<span class="mxinfo" id="T1:U369">Ccoeff(<span class="var type1" id="S43T1U495">k</span>,<span class="mxinfo" id="T1:U371">0</span>,<span class="mxinfo" id="T1:U372"><span class="var type1" id="S19T2U498">t</span>(<span class="var type1" id="S34T1U499">i</span>)</span>,<span class="mxinfo" id="T48:U375"><span class="var type1" id="S22T48U500">gridX</span></span>)</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo" id="T67:U358"><span class="mxinfo" id="T67:U368">                          <span class="mxinfo" id="T1:U377">Ccoeff(<span class="var type1" id="S43T1U504">k</span>,<span class="mxinfo" id="T1:U379">1</span>,<span class="mxinfo" id="T1:U380"><span class="var type1" id="S19T2U507">t</span>(<span class="var type1" id="S34T1U508">i</span>)</span>,<span class="mxinfo" id="T48:U383"><span class="var type1" id="S22T48U509">gridX</span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,110" id="srcline110">110</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,111" id="srcline111">111</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,113" id="srcline113">113</a></span><span class="line"><span class="comment">% Solve the equation</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,114" id="srcline114">114</a></span><span class="line"><span class="comment">% r =((X'*X+lambda*regTerm)^-1)*X'Y, with r the source and X and Y are to be</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,115" id="srcline115">115</a></span><span class="line"><span class="comment">% calculated</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,117" id="srcline117">117</a></span><span class="line"><span class="comment">% Calculate the components of X and Y</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo" id="T50:U385"><span class="var type1" id="S45T50U512">s1</span> = <span class="mxinfo" id="T50:U387">zeros(<span class="var type1" id="S11T1U515">N</span>,<span class="var type1" id="S11T1U516">N</span>,<span class="mxinfo" id="T1:U390"><span class="var type1" id="S9T1U517">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo" id="T45:U392"><span class="var type1" id="S46T45U520">s2</span> = <span class="mxinfo" id="T45:U394">zeros(<span class="var type1" id="S11T1U523">N</span>,<span class="mxinfo" id="T1:U396"><span class="var type1" id="S9T1U524">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,120" id="srcline120">120</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S43T1U527">k</span> = <span class="mxinfo" id="T1:U399">1</span>:<span class="var type1" id="S9T1U530">N0</span><span class="comment">% space variable</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,121" id="srcline121">121</a></span><span class="line">    <span class="comment">% components of X</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,122" id="srcline122">122</a></span><span class="line">    <span class="mxinfo" id="T20:U401"><span class="var type1" id="S47T20U533">a1k</span> = <span class="mxinfo" id="T20:U403"><span class="fcn" id="F463N3:B535">Aone</span>(<span class="var type1" id="S43T1U536">k</span>,<span class="var type1" id="S23T47U537">x</span>,<span class="var type1" id="S19T2U538">t</span>,<span class="var type1" id="S18T2U539">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,123" id="srcline123">123</a></span><span class="line">    <span class="mxinfo" id="T20:U408"><span class="var type1" id="S49T20U542">b1k</span> = <span class="mxinfo" id="T20:U410"><span class="fcn" id="F464N5:B544">Bone</span>(<span class="var type1" id="S43T1U545">k</span>,<span class="var type1" id="S23T47U546">x</span>,<span class="var type1" id="S19T2U547">t</span>,<span class="var type1" id="S18T2U548">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,124" id="srcline124">124</a></span><span class="line">    <span class="mxinfo" id="T20:U415"><span class="var type1" id="S51T20U551">b1s</span> = <span class="mxinfo" id="T20:U417"><span class="fcn" id="F465N6:B553">BoneStar</span>(<span class="var type1" id="S43T1U554">k</span>,<span class="var type1" id="S23T47U555">x</span>,<span class="var type1" id="S19T2U556">t</span>,<span class="var type1" id="S18T2U557">gridT</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="136,125" id="srcline125">125</a></span><span class="line">    <span class="mxinfo" id="T20:U422"><span class="var type1" id="S53T20U560">ax</span>  = <span class="mxinfo" id="T20:U424">(<span class="mxinfo" id="T20:U425"><span class="var type1" id="S47T20U564">a1k</span>-<span class="mxinfo" id="T20:U427">(<span class="mxinfo" id="T1:U428">1/<span class="var type1" id="S8T1U569">alpha</span></span>)*(<span class="mxinfo" id="T20:U430"><span class="var type1" id="S49T20U572">b1k</span>-<span class="var type1" id="S51T20U573">b1s</span></span>)</span></span>)/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo" id="T20:U422"><span class="mxinfo" id="T20:U424">         (<span class="mxinfo" id="T20:U433"><span class="var type1" id="S29T20U576">A</span>-<span class="mxinfo" id="T20:U435">(<span class="mxinfo" id="T1:U436">1/<span class="var type1" id="S8T1U581">alpha</span></span>)*(<span class="mxinfo" id="T20:U438"><span class="var type1" id="S30T20U584">B</span>+<span class="var type1" id="S31T20U585">Bstar</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,127" id="srcline127">127</a></span><span class="line">    <span class="mxinfo" id="T20:U441"><span class="mxinfo" id="T20:U442"><span class="var type1" id="S45T50U589">s1</span>(:,:,<span class="var type1" id="S43T1U592">k</span>)</span> = <span class="mxinfo" id="T20:U445">(<span class="mxinfo" id="T1:U446"><span class="mxinfo" id="T1:U447">1</span>/<span class="mxinfo" id="T1:U448"><span class="var type1" id="S9T1U597">N0</span></span></span>).*(<span class="mxinfo" id="T20:U450"><span class="mxinfo" id="T20:U451"><span class="mxinfo" id="T20:U452">-<span class="var type1" id="S53T20U602">ax</span></span>*<span class="var type1" id="S32T20U603">D</span></span> + <span class="mxinfo" id="T20:U455"><span class="fcn" id="F561N10:B605">Done</span>(<span class="var type1" id="S43T1U606">k</span>,<span class="var type1" id="S23T47U607">x</span>,<span class="var type1" id="S19T2U608">t</span>,<span class="var type1" id="S18T2U609">gridT</span>,<span class="var type1" id="S13T45U610">f</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,128" id="srcline128">128</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,129" id="srcline129">129</a></span><span class="line">    <span class="comment">% components of Y</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,130" id="srcline130">130</a></span><span class="line">    <span class="mxinfo" id="T20:U461"><span class="var type1" id="S55T20U613">ay</span> = <span class="mxinfo" id="T20:U463">(<span class="mxinfo" id="T20:U464"><span class="var type1" id="S47T20U617">a1k</span>-<span class="mxinfo" id="T20:U466">(<span class="mxinfo" id="T1:U467">1/<span class="var type1" id="S8T1U622">alpha</span></span>)*(<span class="mxinfo" id="T20:U469"><span class="var type1" id="S49T20U625">b1k</span>+<span class="var type1" id="S51T20U626">b1s</span></span>)</span></span>)/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,131" id="srcline131">131</a></span><span class="line"><span class="mxinfo" id="T20:U461"><span class="mxinfo" id="T20:U463">         (<span class="mxinfo" id="T20:U472"><span class="var type1" id="S29T20U629">A</span>-<span class="mxinfo" id="T20:U474">(<span class="mxinfo" id="T1:U475">1/<span class="var type1" id="S8T1U634">alpha</span></span>)*(<span class="mxinfo" id="T20:U477"><span class="var type1" id="S30T20U637">B</span>+<span class="var type1" id="S31T20U638">Bstar</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,132" id="srcline132">132</a></span><span class="line">    <span class="mxinfo" id="T37:U480"><span class="mxinfo" id="T37:U481"><span class="var type1" id="S46T45U642">s2</span>(:,<span class="var type1" id="S43T1U644">k</span>)</span> = <span class="mxinfo" id="T37:U484"><span class="mxinfo" id="T45:U485">(<span class="mxinfo" id="T1:U486">1/<span class="var type1" id="S9T1U650">N0</span></span>)*(<span class="mxinfo" id="T45:U488"><span class="mxinfo" id="T45:U489"><span class="var type1" id="S55T20U654">ay</span>*<span class="var type1" id="S42T45U655">C</span></span>-<span class="mxinfo" id="T45:U492"><span class="fcn" id="F588N8:B657">Cone</span>(<span class="var type1" id="S23T47U658">x</span>,<span class="var type1" id="S22T48U659">gridX</span>,<span class="var type1" id="S19T2U660">t</span>)</span></span>)</span>*<span class="mxinfo" id="T49:U496"><span class="var type1" id="S15T47U662">u0</span>'</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="136,133" id="srcline133">133</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,135" id="srcline135">135</a></span><span class="line"><span class="mxinfo" id="T20:U498"><span class="var type1" id="S57T20U665">X</span> = <span class="mxinfo" id="T20:U500">sum(<span class="var type1" id="S45T50U668">s1</span>,3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,136" id="srcline136">136</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo" id="T37:U502"><span class="var type1" id="S59T37U672">Y</span> = <span class="mxinfo" id="T37:U504"><span class="mxinfo" id="T37:U505"><span class="var type1" id="S10T2U675">E</span>'</span>+<span class="mxinfo" id="T37:U507">sum(<span class="var type1" id="S46T45U678">s2</span>,2)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,138" id="srcline138">138</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo" id="T20:U509"><span class="var type1" id="S60T20U682">regTerm</span> = <span class="mxinfo" id="T20:U511"><span class="fcn" id="F367N11:B684">GetRegularizationTerm</span>(<span class="var type1" id="S11T1U685">N</span>,<span class="var type1" id="S5T1U686">regOrder</span>)</span></span>; <span class="comment">% get RregTerm= 'R term</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,140" id="srcline140">140</a></span><span class="line"><span class="comment">% The source solution with regularization coefficient lambda is</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo" id="T37:U514"><span class="var type1" id="S3T37U689">r</span>   = <span class="mxinfo" id="T37:U516">(<span class="mxinfo" id="T20:U517"><span class="mxinfo" id="T20:U518">(<span class="mxinfo" id="T20:U519"><span class="var type1" id="S57T20U696">X</span>'</span>)*<span class="var type1" id="S57T20U697">X</span></span>+<span class="mxinfo" id="T20:U522"><span class="var type1" id="S6T1U699">lambda</span>*<span class="var type1" id="S60T20U700">regTerm</span></span></span>)\(<span class="mxinfo" id="T37:U525"><span class="mxinfo" id="T20:U526"><span class="var type1" id="S57T20U704">X</span>'</span>*<span class="var type1" id="S59T37U705">Y</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,143" id="srcline143">143</a></span><span class="line"><span class="comment">% Calculate the solution u(x,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,144" id="srcline144">144</a></span><span class="line"><span class="mxinfo" id="T47:U529"><span class="var type1" id="S62T47U708">eta</span>     = <span class="mxinfo" id="T47:U531">ones(<span class="mxinfo" id="T1:U532">1</span>,<span class="mxinfo" id="T1:U533"><span class="var type1" id="S9T1U712">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,145" id="srcline145">145</a></span><span class="line"><span class="mxinfo" id="T1:U535"><span class="mxinfo" id="T1:U536"><span class="var type1" id="S62T47U716">eta</span>(<span class="mxinfo" id="T1:U538">1</span>)</span>  = <span class="mxinfo" id="T1:U539">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,146" id="srcline146">146</a></span><span class="line"><span class="mxinfo" id="T1:U540"><span class="mxinfo" id="T1:U541"><span class="var type1" id="S62T47U722">eta</span>(<span class="mxinfo" id="T1:U543"><span class="var type1" id="S9T1U723">N0</span></span>)</span> = <span class="mxinfo" id="T1:U545">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo" id="T45:U546"><span class="var type1" id="S2T45U727">u</span>       = <span class="mxinfo" id="T45:U548">zeros(<span class="var type1" id="S11T1U730">N</span>,<span class="mxinfo" id="T1:U550"><span class="var type1" id="S9T1U731">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,148" id="srcline148">148</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S33T1U734">j</span>=<span class="mxinfo" id="T1:U553">1</span>:<span class="var type1" id="S9T1U737">N0</span>    <span class="comment">% space index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,149" id="srcline149">149</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S34T1U740">i</span>=<span class="mxinfo" id="T1:U556">1</span>:<span class="var type1" id="S11T1U743">N</span> <span class="comment">% time index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,150" id="srcline150">150</a></span><span class="line">        <span class="mxinfo" id="T1:U558"><span class="var type1" id="S63T1U746">sTime</span>   = <span class="mxinfo" id="T1:U560">0</span></span>;<span class="comment">% cumulative sums</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,151" id="srcline151">151</a></span><span class="line">        <span class="mxinfo" id="T1:U561"><span class="var type1" id="S64T1U750">sSpace</span>  = <span class="mxinfo" id="T1:U563">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,152" id="srcline152">152</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S65T1U754">stIdx</span> = <span class="mxinfo" id="T1:U565">1</span>:<span class="var type1" id="S11T1U757">N</span> <span class="comment">% time index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,154" id="srcline154">154</a></span><span class="line">            <span class="mxinfo" id="T1:U567"><span class="var type1" id="S63T1U760">sTime</span> = <span class="mxinfo" id="T1:U569"><span class="mxinfo" id="T1:U570"><span class="mxinfo" id="T1:U571"><span class="mxinfo" id="T1:U572"><span class="mxinfo" id="T1:U573"><span class="var type1" id="S63T1U766">sTime</span>+ <span class="mxinfo" id="T1:U575"><span class="mxinfo" id="T1:U576"><span class="fcn" id="F1N2:B769">Acoeff</span>(<span class="mxinfo" id="T1:U577">0</span>,<span class="var type1" id="S65T1U771">stIdx</span>,<span class="mxinfo" id="T1:U579"><span class="var type1" id="S23T47U773">x</span>(<span class="var type1" id="S33T1U774">j</span>)</span>,<span class="mxinfo" id="T1:U582"><span class="var type1" id="S19T2U776">t</span>(<span class="var type1" id="S34T1U777">i</span>)</span>,<span class="var type1" id="S18T2U778">gridT</span>)</span>*<span class="mxinfo" id="T1:U586"><span class="var type1" id="S27T37U780">q0j</span>(<span class="var type1" id="S65T1U781">stIdx</span>)</span></span></span> + <span class="mxinfo" id="T1:U589"><span class="mxinfo" id="T1:U590"><span class="fcn" id="F1N2:B784">Acoeff</span>(<span class="mxinfo" id="T1:U591">1</span>,<span class="var type1" id="S65T1U786">stIdx</span>,<span class="mxinfo" id="T1:U593"><span class="var type1" id="S23T47U788">x</span>(<span class="var type1" id="S33T1U789">j</span>)</span>,<span class="mxinfo" id="T1:U596"><span class="var type1" id="S19T2U791">t</span>(<span class="var type1" id="S34T1U792">i</span>)</span>, <span class="var type1" id="S18T2U793">gridT</span>)</span>*<span class="mxinfo" id="T1:U600"><span class="var type1" id="S28T37U795">q1j</span>(<span class="var type1" id="S65T1U796">stIdx</span>)</span></span></span>-<span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo" id="T1:U567"><span class="mxinfo" id="T1:U569"><span class="mxinfo" id="T1:U570"><span class="mxinfo" id="T1:U571">                <span class="mxinfo" id="T1:U603"><span class="mxinfo" id="T1:U604"><span class="fcn" id="F75N4:B799">Bcoeff</span>(<span class="mxinfo" id="T1:U605">0</span>,<span class="var type1" id="S65T1U801">stIdx</span>,<span class="mxinfo" id="T1:U607"><span class="var type1" id="S23T47U803">x</span>(<span class="var type1" id="S33T1U804">j</span>)</span>,<span class="mxinfo" id="T1:U610"><span class="var type1" id="S19T2U806">t</span>(<span class="var type1" id="S34T1U807">i</span>)</span>,<span class="var type1" id="S18T2U808">gridT</span>)</span>*<span class="mxinfo" id="T1:U614"><span class="var type1" id="S25T37U810">h0j</span>(<span class="var type1" id="S65T1U811">stIdx</span>)</span></span></span> - <span class="mxinfo" id="T1:U617"><span class="mxinfo" id="T1:U618"><span class="fcn" id="F75N4:B814">Bcoeff</span>(<span class="mxinfo" id="T1:U619">1</span>,<span class="var type1" id="S65T1U816">stIdx</span>,<span class="mxinfo" id="T1:U621"><span class="var type1" id="S23T47U818">x</span>(<span class="var type1" id="S33T1U819">j</span>)</span>,<span class="mxinfo" id="T1:U624"><span class="var type1" id="S19T2U821">t</span>(<span class="var type1" id="S34T1U822">i</span>)</span>, <span class="var type1" id="S18T2U823">gridT</span>)</span>*<span class="mxinfo" id="T1:U628"><span class="var type1" id="S26T37U825">h1j</span>(<span class="var type1" id="S65T1U826">stIdx</span>)</span></span></span>+<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo" id="T1:U567"><span class="mxinfo" id="T1:U569">                <span class="mxinfo" id="T1:U631"><span class="mxinfo" id="T1:U632"><span class="fcn" id="F461N9:B829">Dcoeff</span>(<span class="var type1" id="S23T47U830">x</span>,<span class="var type1" id="S65T1U831">stIdx</span>,<span class="mxinfo" id="T1:U635"><span class="var type1" id="S23T47U833">x</span>(<span class="var type1" id="S33T1U834">j</span>)</span>,<span class="mxinfo" id="T1:U638"><span class="var type1" id="S19T2U836">t</span>(<span class="var type1" id="S34T1U837">i</span>)</span>,<span class="var type1" id="S18T2U838">gridT</span>,<span class="mxinfo" id="T47:U642"><span class="var type1" id="S13T45U840">f</span>(<span class="var type1" id="S34T1U841">i</span>,:)</span>)</span>*<span class="mxinfo" id="T1:U645"><span class="var type1" id="S3T37U844">r</span>(<span class="var type1" id="S65T1U845">stIdx</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,157" id="srcline157">157</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,158" id="srcline158">158</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,159" id="srcline159">159</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S66T1U848">ssIdx</span> = <span class="mxinfo" id="T1:U649">1</span>:<span class="var type1" id="S9T1U851">N0</span> <span class="comment">% space index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,160" id="srcline160">160</a></span><span class="line">            <span class="mxinfo" id="T1:U651"><span class="var type1" id="S64T1U854">sSpace</span> = <span class="mxinfo" id="T1:U653"><span class="var type1" id="S64T1U856">sSpace</span> +<span class="mxinfo" id="T1:U655"><span class="mxinfo" id="T1:U656"><span class="fcn" id="F661N7:B859">Ccoeff</span>(<span class="var type1" id="S66T1U860">ssIdx</span>,<span class="mxinfo" id="T1:U658"><span class="var type1" id="S23T47U862">x</span>(<span class="var type1" id="S33T1U863">j</span>)</span>,<span class="mxinfo" id="T1:U661"><span class="var type1" id="S19T2U865">t</span>(<span class="var type1" id="S34T1U866">i</span>)</span>,<span class="var type1" id="S18T2U867">gridT</span>)</span>*<span class="mxinfo" id="T1:U665"><span class="var type1" id="S15T47U869">u0</span>(<span class="var type1" id="S66T1U870">ssIdx</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,161" id="srcline161">161</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,162" id="srcline162">162</a></span><span class="line">        <span class="mxinfo" id="T1:U668"><span class="mxinfo" id="T1:U669"><span class="var type1" id="S2T45U874">u</span>(<span class="var type1" id="S34T1U875">i</span>,<span class="var type1" id="S33T1U876">j</span>)</span> = <span class="mxinfo" id="T1:U673">(<span class="mxinfo" id="T1:U674"><span class="var type1" id="S63T1U880">sTime</span>+<span class="var type1" id="S64T1U881">sSpace</span></span>)*<span class="mxinfo" id="T1:U677"><span class="var type1" id="S62T47U883">eta</span>(<span class="var type1" id="S33T1U884">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,164" id="srcline164">164</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,165" id="srcline165">165</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U680">all(<span class="var type1" id="S7T3U889">plotFlag</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,166" id="srcline166">166</a></span><span class="line"><span class="fcn" id="F671N12:B892">PlotResults</span>(<span class="var type1" id="S19T2U893">t</span>,<span class="var type1" id="S4T2U894">sigIn</span>,<span class="var type1" id="S2T45U895">u</span>,<span class="var type1" id="S3T37U896">r</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="136,167" id="srcline167">167</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,168" id="srcline168">168</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
