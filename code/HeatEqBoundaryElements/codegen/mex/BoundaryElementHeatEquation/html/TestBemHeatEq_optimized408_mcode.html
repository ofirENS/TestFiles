<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="136,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T45U3">u</span>,<span class="var type1" id="S3T37U4">r</span>]= TestBemHeatEq_optimized(<span class="var type1" id="S4T2U7">sigIn</span>,<span class="var type1" id="S5T1U8">regOrder</span>,<span class="var type1" id="S6T1U9">lambda</span>,<span class="var type1" id="S7T3U10">plotFlag</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="136,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Solve the inveerse heat equation with an unknown source</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% u_t(x,t) = ku_{xx}(x,y) +r(t)*f(x,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% with 0&lt;=x&lt;=1, 0&lt;=t&lt;=T</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% subject to the boundary conditions u(0,t) = u(1,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% and u_x(0,t)+alpha*u(0,t)=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% and initial condition</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% u(x,0) = phi(x) =u0, 0&lt;=x&lt;=1</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% In this problem we take f(x,t) =1 for all x and t</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,11" id="srcline11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% The convention for most matrices is that rows are time, columns are space</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo" id="T1:U7"><span class="var type1" id="S8T1U13">alpha</span>    = <span class="mxinfo" id="T1:U9">-1</span></span>; <span class="comment">% for the boundary condition</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% lambda   = 1.7; % regularization constant (affects smoothness of source solution)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% regOrder = 2;  % Tikhonov regularization term order, [0,1,or 2]</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% if ~exist('sigIn','var')</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%     N0     = 3;   % space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%     N      = 150; % time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%     % test signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%     sigIn      = (3*cos((1:N) *pi/8)./N+0.5*randn(1,N));% a vector of N points is the integral of the solution over the space</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%     E          = sigIn;</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,24" id="srcline24"> 24</a></span><span class="line">    <span class="mxinfo" id="T1:U10"><span class="var type1" id="S9T1U18">N0</span> = <span class="mxinfo" id="T1:U12">3</span></span>;        <span class="comment">% space points;</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,25" id="srcline25"> 25</a></span><span class="line">    <span class="mxinfo" id="T2:U13"><span class="var type1" id="S10T2U22">E</span>  = (<span class="var type1" id="S4T2U24">sigIn</span>)</span>;  <span class="comment">% int(u(x,t)dx) is a time function of size 1xN</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,26" id="srcline26"> 26</a></span><span class="line">    <span class="mxinfo" id="T1:U16"><span class="var type1" id="S11T1U27">N</span>  = <span class="mxinfo" id="T1:U18">numel(<span class="var type1" id="S10T2U30">E</span>)</span></span>; <span class="comment">% time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T45:U20"><span class="var type1" id="S13T45U33">f</span>      = <span class="mxinfo" id="T45:U22"><span class="mxinfo" id="T1:U23">1</span>*<span class="mxinfo" id="T45:U24">ones(<span class="var type1" id="S11T1U38">N</span>,<span class="mxinfo" id="T1:U26"><span class="var type1" id="S9T1U39">N0</span></span>)</span></span></span>; <span class="comment">% function of N time points over N0 space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo" id="T46:U28"><span class="var type1" id="S15T46U42">u0</span>     = <span class="mxinfo" id="T46:U30"><span class="mxinfo" id="T1:U31">max(<span class="mxinfo" id="T54:U32"><span class="var type1" id="S10T2U47">E</span>(<span class="mxinfo" id="T1:U34">1</span>:<span class="mxinfo" id="T1:U35">min(<span class="mxinfo" id="T1:U36">10</span>,<span class="mxinfo" id="T1:U37">numel(<span class="var type1" id="S10T2U55">E</span>)</span>)</span>)</span>)</span>*<span class="mxinfo" id="T46:U39">ones(1,<span class="var type1" id="S9T1U59">N0</span>)</span></span></span>; <span class="comment">% is the phi function</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% Discretize the time and space domain</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T1:U41"><span class="var type1" id="S18T1U62">T</span>      = <span class="mxinfo" id="T1:U43">numel(<span class="var type1" id="S10T2U65">E</span>)</span></span>;         <span class="comment">% max time;</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T2:U45"><span class="var type1" id="S19T2U68">gridT</span>  = <span class="mxinfo" id="T2:U47">(<span class="mxinfo" id="T2:U48">0:(<span class="var type1" id="S11T1U74">N</span>)</span>).*(<span class="mxinfo" id="T1:U50"><span class="var type1" id="S18T1U77">T</span>/<span class="var type1" id="S11T1U78">N</span></span>)</span></span>;<span class="comment">% N+1 points</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo" id="T2:U53"><span class="var type1" id="S20T2U81">t</span>      = <span class="mxinfo" id="T2:U55">zeros(<span class="mxinfo" id="T1:U56">1</span>,<span class="var type1" id="S11T1U85">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,35" id="srcline35"> 35</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S22T1U88">tIdx</span> = <span class="mxinfo" id="T1:U59">1</span>:<span class="var type1" id="S11T1U91">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,36" id="srcline36"> 36</a></span><span class="line">    <span class="mxinfo" id="T1:U61"><span class="mxinfo" id="T1:U62"><span class="var type1" id="S20T2U95">t</span>(<span class="var type1" id="S22T1U96">tIdx</span>)</span> = <span class="mxinfo" id="T1:U65">(<span class="mxinfo" id="T1:U66"><span class="mxinfo" id="T1:U67"><span class="var type1" id="S19T2U101">gridT</span>(<span class="var type1" id="S22T1U102">tIdx</span>)</span>+<span class="mxinfo" id="T1:U70"><span class="var type1" id="S19T2U104">gridT</span>(<span class="mxinfo" id="T1:U72"><span class="var type1" id="S22T1U106">tIdx</span>+<span class="mxinfo" id="T1:U74">1</span></span>)</span></span>)/<span class="mxinfo" id="T1:U75">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T47:U76"><span class="var type1" id="S23T47U111">gridX</span> = <span class="mxinfo" id="T47:U78">(0:(<span class="var type1" id="S9T1U117">N0</span>))./<span class="var type1" id="S9T1U118">N0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo" id="T46:U81"><span class="var type1" id="S24T46U121">x</span>     = <span class="mxinfo" id="T46:U83">zeros(<span class="mxinfo" id="T1:U84">1</span>,<span class="mxinfo" id="T1:U85"><span class="var type1" id="S9T1U125">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,40" id="srcline40"> 40</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S25T1U128">xIdx</span> = <span class="mxinfo" id="T1:U88">1</span>:numel(<span class="var type1" id="S24T46U133">x</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="136,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo" id="T1:U90"><span class="mxinfo" id="T1:U91"><span class="var type1" id="S24T46U137">x</span>(<span class="var type1" id="S25T1U138">xIdx</span>)</span> = <span class="mxinfo" id="T1:U94">(<span class="mxinfo" id="T1:U95"><span class="mxinfo" id="T1:U96"><span class="var type1" id="S23T47U143">gridX</span>(<span class="mxinfo" id="T1:U98"><span class="var type1" id="S25T1U145">xIdx</span>+<span class="mxinfo" id="T1:U100">1</span></span>)</span>+<span class="mxinfo" id="T1:U101"><span class="var type1" id="S23T47U148">gridX</span>(<span class="var type1" id="S25T1U149">xIdx</span>)</span></span>)/<span class="mxinfo" id="T1:U104">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,42" id="srcline42"> 42</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">% Determine the boundary and initial functions</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% u(0,t) = h0j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo" id="T37:U105"><span class="var type1" id="S26T37U153">h0j</span> = <span class="mxinfo" id="T37:U107">zeros(<span class="var type1" id="S11T1U156">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% u(1,t) = h1j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo" id="T37:U109"><span class="var type1" id="S27T37U160">h1j</span> = <span class="mxinfo" id="T37:U111">zeros(<span class="var type1" id="S11T1U163">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% du/dn(0,t) = q0j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo" id="T37:U113"><span class="var type1" id="S28T37U167">q0j</span> = <span class="mxinfo" id="T37:U115">zeros(<span class="var type1" id="S11T1U170">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%du/dn(1,t) = q1j</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T37:U117"><span class="var type1" id="S29T37U174">q1j</span> = <span class="mxinfo" id="T37:U119">zeros(<span class="var type1" id="S11T1U177">N</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%===========================</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">% Calculate the matrix for the Acoeff,Bcoeff, BStar, D, C to be used later</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% for A,B,C,D</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% the spatial domain for the calculation is the [0, x, 1]</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% xPoints   = [0, x, 1]; % add boundary points to the intermidiate ones</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% Nx        = numel(xPoints);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% aCoeffMat0 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% aCoeffMat1 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% bCoeffMat0 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">% bCoeffMat1 = zeros(N,Nx);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% for j=1:numel(xPoints)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%     for i=1:N</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%         aCoeffMat0(i,j) = Acoeff(0,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%         aCoeffMat1(i,j) = Acoeff(1,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%         bCoeffMat0(i,j) = Bcoeff(0,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%         bCoeffMat1(i,j) = Bcoeff(1,xPoints(j),t(i),gridT(i:i+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% Calculate the Boundary Elements</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">% Calculate A and B, B*, and D</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo" id="T20:U121"><span class="var type1" id="S30T20U181">A</span>      = <span class="mxinfo" id="T20:U123">zeros(<span class="mxinfo" id="T1:U124"><span class="mxinfo" id="T1:U125">2</span>*<span class="var type1" id="S11T1U186">N</span></span>,<span class="mxinfo" id="T1:U127"><span class="mxinfo" id="T1:U128">2</span>*<span class="var type1" id="S11T1U189">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo" id="T20:U130"><span class="var type1" id="S31T20U192">B</span>      = <span class="mxinfo" id="T20:U132">zeros(<span class="mxinfo" id="T1:U133"><span class="mxinfo" id="T1:U134">2</span>*<span class="var type1" id="S11T1U197">N</span></span>,<span class="mxinfo" id="T1:U136"><span class="mxinfo" id="T1:U137">2</span>*<span class="var type1" id="S11T1U200">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo" id="T20:U139"><span class="var type1" id="S32T20U203">Bstar</span>  = <span class="mxinfo" id="T20:U141">zeros(<span class="mxinfo" id="T1:U142"><span class="mxinfo" id="T1:U143">2</span>*<span class="var type1" id="S11T1U208">N</span></span>,<span class="mxinfo" id="T1:U145"><span class="mxinfo" id="T1:U146">2</span>*<span class="var type1" id="S11T1U211">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo" id="T20:U148"><span class="var type1" id="S33T20U214">D</span>      = <span class="mxinfo" id="T20:U150">zeros(<span class="mxinfo" id="T1:U151"><span class="mxinfo" id="T1:U152">2</span>*<span class="var type1" id="S11T1U219">N</span></span>,<span class="var type1" id="S11T1U220">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,82" id="srcline82"> 82</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T1U223">j</span> = <span class="mxinfo" id="T1:U156">1</span>:<span class="var type1" id="S11T1U226">N</span> <span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,83" id="srcline83"> 83</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S35T1U229">i</span> = <span class="mxinfo" id="T1:U159">1</span>:<span class="var type1" id="S11T1U232">N</span> <span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,84" id="srcline84"> 84</a></span><span class="line">        <span class="mxinfo" id="T1:U161"><span class="var type1" id="S36T1U235">deltaij</span> = <span class="mxinfo" id="T1:U163">double(<span class="mxinfo" id="T3:U164"><span class="var type1" id="S35T1U239">i</span>==<span class="var type1" id="S34T1U240">j</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%         A(2*i-1:2*i,2*j-1:2*j) = [aCoeffMat0(1,i), aCoeffMat1(1,i);<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%                                   aCoeffMat0(end,i), aCoeffMat1(end,i)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,87" id="srcline87"> 87</a></span><span class="line">        <span class="mxinfo" id="T66:U167"><span class="mxinfo" id="T66:U168"><span class="var type1" id="S30T20U244">A</span>(<span class="mxinfo" id="T67:U170"><span class="mxinfo" id="T1:U171"><span class="mxinfo" id="T1:U172"><span class="mxinfo" id="T1:U173">2</span>*<span class="var type1" id="S35T1U249">i</span></span>-1</span>:2*<span class="var type1" id="S35T1U253">i</span></span>,<span class="mxinfo" id="T67:U176"><span class="mxinfo" id="T1:U177"><span class="mxinfo" id="T1:U178"><span class="mxinfo" id="T1:U179">2</span>*<span class="var type1" id="S34T1U258">j</span></span>-1</span>:2*<span class="var type1" id="S34T1U262">j</span></span>)</span> = <span class="mxinfo" id="T66:U182">[<span class="mxinfo" id="T15:U183"><span class="mxinfo" id="T1:U184"><span class="fcn" id="F1N2:B266">Acoeff</span>(<span class="mxinfo" id="T1:U185">0</span>,<span class="var type1" id="S34T1U268">j</span>,<span class="mxinfo" id="T1:U187">0</span>,<span class="mxinfo" id="T1:U188"><span class="var type1" id="S20T2U271">t</span>(<span class="var type1" id="S35T1U272">i</span>)</span>,<span class="var type1" id="S19T2U273">gridT</span>)</span>, <span class="mxinfo" id="T1:U192"><span class="fcn" id="F1N2:B275">Acoeff</span>(<span class="mxinfo" id="T1:U193">1</span>,<span class="var type1" id="S34T1U277">j</span>,<span class="mxinfo" id="T1:U195">0</span>,<span class="mxinfo" id="T1:U196"><span class="var type1" id="S20T2U280">t</span>(<span class="var type1" id="S35T1U281">i</span>)</span>,<span class="var type1" id="S19T2U282">gridT</span>)</span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo" id="T66:U167"><span class="mxinfo" id="T66:U182">                                  <span class="mxinfo" id="T15:U200"><span class="mxinfo" id="T1:U201"><span class="fcn" id="F1N2:B285">Acoeff</span>(<span class="mxinfo" id="T1:U202">0</span>,<span class="var type1" id="S34T1U287">j</span>,<span class="mxinfo" id="T1:U204">1</span>,<span class="mxinfo" id="T1:U205"><span class="var type1" id="S20T2U290">t</span>(<span class="var type1" id="S35T1U291">i</span>)</span>,<span class="var type1" id="S19T2U292">gridT</span>)</span>, <span class="mxinfo" id="T1:U209"><span class="fcn" id="F1N2:B294">Acoeff</span>(<span class="mxinfo" id="T1:U210">1</span>,<span class="var type1" id="S34T1U296">j</span>,<span class="mxinfo" id="T1:U212">1</span>,<span class="mxinfo" id="T1:U213"><span class="var type1" id="S20T2U299">t</span>(<span class="var type1" id="S35T1U300">i</span>)</span>,<span class="var type1" id="S19T2U301">gridT</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,89" id="srcline89"> 89</a></span><span class="line">        <span class="comment">% temp terms</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,90" id="srcline90"> 90</a></span><span class="line">        <span class="mxinfo" id="T1:U217"><span class="var type1" id="S39T1U304">b1j0i</span> = <span class="mxinfo" id="T1:U219"><span class="fcn" id="F75N4:B306">Bcoeff</span>(<span class="mxinfo" id="T1:U220">1</span>,<span class="var type1" id="S34T1U308">j</span>,<span class="mxinfo" id="T1:U222">0</span>,<span class="mxinfo" id="T1:U223"><span class="var type1" id="S20T2U311">t</span>(<span class="var type1" id="S35T1U312">i</span>)</span>,<span class="var type1" id="S19T2U313">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,91" id="srcline91"> 91</a></span><span class="line">        <span class="mxinfo" id="T1:U227"><span class="var type1" id="S41T1U316">b1j1i</span> = <span class="mxinfo" id="T1:U229"><span class="fcn" id="F75N4:B318">Bcoeff</span>(<span class="mxinfo" id="T1:U230">1</span>,<span class="var type1" id="S34T1U320">j</span>,<span class="mxinfo" id="T1:U232">1</span>,<span class="mxinfo" id="T1:U233"><span class="var type1" id="S20T2U323">t</span>(<span class="var type1" id="S35T1U324">i</span>)</span>,<span class="var type1" id="S19T2U325">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,92" id="srcline92"> 92</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,93" id="srcline93"> 93</a></span><span class="line">        <span class="mxinfo" id="T66:U237"><span class="mxinfo" id="T66:U238"><span class="var type1" id="S31T20U329">B</span>(<span class="mxinfo" id="T67:U240"><span class="mxinfo" id="T1:U241"><span class="mxinfo" id="T1:U242"><span class="mxinfo" id="T1:U243">2</span>*<span class="var type1" id="S35T1U334">i</span></span>-1</span>:2*<span class="var type1" id="S35T1U338">i</span></span>,<span class="mxinfo" id="T67:U246"><span class="mxinfo" id="T1:U247"><span class="mxinfo" id="T1:U248"><span class="mxinfo" id="T1:U249">2</span>*<span class="var type1" id="S34T1U343">j</span></span>-1</span>:2*<span class="var type1" id="S34T1U347">j</span></span>)</span> = <span class="mxinfo" id="T66:U252">[<span class="mxinfo" id="T15:U253"><span class="mxinfo" id="T1:U254"><span class="mxinfo" id="T1:U255"><span class="fcn" id="F75N4:B352">Bcoeff</span>(<span class="mxinfo" id="T1:U256">0</span>,<span class="var type1" id="S34T1U354">j</span>,<span class="mxinfo" id="T1:U258">0</span>,<span class="mxinfo" id="T1:U259"><span class="var type1" id="S20T2U357">t</span>(<span class="var type1" id="S35T1U358">i</span>)</span>,<span class="var type1" id="S19T2U359">gridT</span>)</span>+<span class="mxinfo" id="T1:U263"><span class="mxinfo" id="T1:U264">0.5</span>*<span class="var type1" id="S36T1U362">deltaij</span></span></span>, <span class="var type1" id="S39T1U363">b1j0i</span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo" id="T66:U237"><span class="mxinfo" id="T66:U252">                                  <span class="mxinfo" id="T15:U267"><span class="mxinfo" id="T1:U268"><span class="fcn" id="F75N4:B366">Bcoeff</span>(<span class="mxinfo" id="T1:U269">0</span>,<span class="var type1" id="S34T1U368">j</span>,<span class="mxinfo" id="T1:U271">1</span>,<span class="mxinfo" id="T1:U272"><span class="var type1" id="S20T2U371">t</span>(<span class="var type1" id="S35T1U372">i</span>)</span>,<span class="var type1" id="S19T2U373">gridT</span>)</span>, <span class="mxinfo" id="T1:U276"><span class="var type1" id="S41T1U375">b1j1i</span>+<span class="mxinfo" id="T1:U278"><span class="mxinfo" id="T1:U279">0.5</span>*<span class="var type1" id="S36T1U378">deltaij</span></span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,95" id="srcline95"> 95</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,96" id="srcline96"> 96</a></span><span class="line">        <span class="mxinfo" id="T66:U281"><span class="mxinfo" id="T66:U282"><span class="var type1" id="S32T20U382">Bstar</span>(<span class="mxinfo" id="T67:U284"><span class="mxinfo" id="T1:U285"><span class="mxinfo" id="T1:U286"><span class="mxinfo" id="T1:U287">2</span>*<span class="var type1" id="S35T1U387">i</span></span>-1</span>:2*<span class="var type1" id="S35T1U391">i</span></span>,<span class="mxinfo" id="T67:U290"><span class="mxinfo" id="T1:U291"><span class="mxinfo" id="T1:U292"><span class="mxinfo" id="T1:U293">2</span>*<span class="var type1" id="S34T1U396">j</span></span>-1</span>:2*<span class="var type1" id="S34T1U400">j</span></span>)</span> = <span class="mxinfo" id="T66:U296">[<span class="mxinfo" id="T15:U297"><span class="var type1" id="S39T1U403">b1j0i</span>,            <span class="mxinfo" id="T1:U299">-<span class="var type1" id="S39T1U405">b1j0i</span></span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo" id="T66:U281"><span class="mxinfo" id="T66:U296">                                      <span class="mxinfo" id="T15:U301"><span class="mxinfo" id="T1:U302"><span class="var type1" id="S41T1U408">b1j1i</span>+<span class="mxinfo" id="T1:U304"><span class="var type1" id="S36T1U410">deltaij</span>/<span class="mxinfo" id="T1:U306">2</span></span></span>, <span class="mxinfo" id="T1:U307"><span class="mxinfo" id="T1:U308">-<span class="var type1" id="S41T1U414">b1j1i</span></span>-<span class="mxinfo" id="T1:U310"><span class="mxinfo" id="T1:U311">0.5</span>*<span class="var type1" id="S36T1U417">deltaij</span></span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,98" id="srcline98"> 98</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,99" id="srcline99"> 99</a></span><span class="line">        <span class="mxinfo" id="T67:U313"><span class="mxinfo" id="T67:U314"><span class="var type1" id="S33T20U421">D</span>(<span class="mxinfo" id="T67:U316"><span class="mxinfo" id="T1:U317"><span class="mxinfo" id="T1:U318"><span class="mxinfo" id="T1:U319">2</span>*<span class="var type1" id="S35T1U426">i</span></span>-1</span>:2*<span class="var type1" id="S35T1U430">i</span></span>,<span class="var type1" id="S34T1U431">j</span>)</span>=<span class="mxinfo" id="T67:U323">[<span class="mxinfo" id="T1:U324">Dcoeff(<span class="var type1" id="S24T46U436">x</span>,<span class="var type1" id="S34T1U437">j</span>,<span class="mxinfo" id="T1:U327">0</span>,<span class="mxinfo" id="T1:U328"><span class="var type1" id="S20T2U440">t</span>(<span class="var type1" id="S35T1U441">i</span>)</span>,<span class="var type1" id="S19T2U442">gridT</span>,<span class="mxinfo" id="T46:U332"><span class="var type1" id="S13T45U444">f</span>(<span class="var type1" id="S35T1U445">i</span>,:)</span>)</span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo" id="T67:U313"><span class="mxinfo" id="T67:U323">                        <span class="mxinfo" id="T1:U335">Dcoeff(<span class="var type1" id="S24T46U450">x</span>,<span class="var type1" id="S34T1U451">j</span>,<span class="mxinfo" id="T1:U338">1</span>,<span class="mxinfo" id="T1:U339"><span class="var type1" id="S20T2U454">t</span>(<span class="var type1" id="S35T1U455">i</span>)</span>,<span class="var type1" id="S19T2U456">gridT</span>,<span class="mxinfo" id="T46:U343"><span class="var type1" id="S13T45U458">f</span>(<span class="var type1" id="S35T1U459">i</span>,:)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,101" id="srcline101">101</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,102" id="srcline102">102</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,104" id="srcline104">104</a></span><span class="line"><span class="comment">% Calculate C</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo" id="T45:U346"><span class="var type1" id="S43T45U463">C</span> = <span class="mxinfo" id="T45:U348">zeros(<span class="mxinfo" id="T1:U349"><span class="mxinfo" id="T1:U350">2</span>*<span class="var type1" id="S11T1U468">N</span></span>,<span class="mxinfo" id="T1:U352"><span class="var type1" id="S9T1U469">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,106" id="srcline106">106</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S44T1U472">k</span> = <span class="mxinfo" id="T1:U355">1</span>:<span class="var type1" id="S9T1U475">N0</span><span class="comment">% space</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,107" id="srcline107">107</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S35T1U478">i</span>=<span class="mxinfo" id="T1:U358">1</span>:<span class="var type1" id="S11T1U481">N</span><span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,108" id="srcline108">108</a></span><span class="line">        <span class="mxinfo" id="T67:U360"><span class="mxinfo" id="T67:U361"><span class="var type1" id="S43T45U485">C</span>(<span class="mxinfo" id="T67:U363"><span class="mxinfo" id="T1:U364"><span class="mxinfo" id="T1:U365"><span class="mxinfo" id="T1:U366">2</span>*<span class="var type1" id="S35T1U490">i</span></span>-1</span>:2*<span class="var type1" id="S35T1U494">i</span></span>,<span class="var type1" id="S44T1U495">k</span>)</span> = <span class="mxinfo" id="T67:U370">[<span class="mxinfo" id="T1:U371">Ccoeff(<span class="var type1" id="S44T1U500">k</span>,<span class="mxinfo" id="T1:U373">0</span>,<span class="mxinfo" id="T1:U374"><span class="var type1" id="S20T2U503">t</span>(<span class="var type1" id="S35T1U504">i</span>)</span>,<span class="mxinfo" id="T47:U377"><span class="var type1" id="S23T47U505">gridX</span></span>)</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo" id="T67:U360"><span class="mxinfo" id="T67:U370">                          <span class="mxinfo" id="T1:U379">Ccoeff(<span class="var type1" id="S44T1U509">k</span>,<span class="mxinfo" id="T1:U381">1</span>,<span class="mxinfo" id="T1:U382"><span class="var type1" id="S20T2U512">t</span>(<span class="var type1" id="S35T1U513">i</span>)</span>,<span class="mxinfo" id="T47:U385"><span class="var type1" id="S23T47U514">gridX</span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,110" id="srcline110">110</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,111" id="srcline111">111</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,113" id="srcline113">113</a></span><span class="line"><span class="comment">% Solve the equation</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,114" id="srcline114">114</a></span><span class="line"><span class="comment">% r =((X'*X+lambda*regTerm)^-1)*X'Y, with r the source and X and Y are to be</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,115" id="srcline115">115</a></span><span class="line"><span class="comment">% calculated</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,117" id="srcline117">117</a></span><span class="line"><span class="comment">% Calculate the components of X and Y</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo" id="T49:U387"><span class="var type1" id="S46T49U517">s1</span> = <span class="mxinfo" id="T49:U389">zeros(<span class="var type1" id="S11T1U520">N</span>,<span class="var type1" id="S11T1U521">N</span>,<span class="mxinfo" id="T1:U392"><span class="var type1" id="S9T1U522">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo" id="T45:U394"><span class="var type1" id="S47T45U525">s2</span> = <span class="mxinfo" id="T45:U396">zeros(<span class="var type1" id="S11T1U528">N</span>,<span class="mxinfo" id="T1:U398"><span class="var type1" id="S9T1U529">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,120" id="srcline120">120</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S44T1U532">k</span> = <span class="mxinfo" id="T1:U401">1</span>:<span class="var type1" id="S9T1U535">N0</span><span class="comment">% space variable</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,121" id="srcline121">121</a></span><span class="line">    <span class="comment">% components of X</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,122" id="srcline122">122</a></span><span class="line">    <span class="mxinfo" id="T20:U403"><span class="var type1" id="S48T20U538">a1k</span> = <span class="mxinfo" id="T20:U405"><span class="fcn" id="F456N3:B540">Aone</span>(<span class="var type1" id="S44T1U541">k</span>,<span class="var type1" id="S24T46U542">x</span>,<span class="var type1" id="S20T2U543">t</span>,<span class="var type1" id="S19T2U544">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,123" id="srcline123">123</a></span><span class="line">    <span class="mxinfo" id="T20:U410"><span class="var type1" id="S50T20U547">b1k</span> = <span class="mxinfo" id="T20:U412"><span class="fcn" id="F457N5:B549">Bone</span>(<span class="var type1" id="S44T1U550">k</span>,<span class="var type1" id="S24T46U551">x</span>,<span class="var type1" id="S20T2U552">t</span>,<span class="var type1" id="S19T2U553">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,124" id="srcline124">124</a></span><span class="line">    <span class="mxinfo" id="T20:U417"><span class="var type1" id="S52T20U556">b1s</span> = <span class="mxinfo" id="T20:U419"><span class="fcn" id="F458N6:B558">BoneStar</span>(<span class="var type1" id="S44T1U559">k</span>,<span class="var type1" id="S24T46U560">x</span>,<span class="var type1" id="S20T2U561">t</span>,<span class="var type1" id="S19T2U562">gridT</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="136,125" id="srcline125">125</a></span><span class="line">    <span class="mxinfo" id="T20:U424"><span class="var type1" id="S54T20U565">ax</span>  = <span class="mxinfo" id="T20:U426">(<span class="mxinfo" id="T20:U427"><span class="var type1" id="S48T20U569">a1k</span>-<span class="mxinfo" id="T20:U429">(<span class="mxinfo" id="T1:U430">1/<span class="var type1" id="S8T1U574">alpha</span></span>)*(<span class="mxinfo" id="T20:U432"><span class="var type1" id="S50T20U577">b1k</span>-<span class="var type1" id="S52T20U578">b1s</span></span>)</span></span>)/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo" id="T20:U424"><span class="mxinfo" id="T20:U426">         (<span class="mxinfo" id="T20:U435"><span class="var type1" id="S30T20U581">A</span>-<span class="mxinfo" id="T20:U437">(<span class="mxinfo" id="T1:U438">1/<span class="var type1" id="S8T1U586">alpha</span></span>)*(<span class="mxinfo" id="T20:U440"><span class="var type1" id="S31T20U589">B</span>+<span class="var type1" id="S32T20U590">Bstar</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,127" id="srcline127">127</a></span><span class="line">    <span class="mxinfo" id="T20:U443"><span class="mxinfo" id="T20:U444"><span class="var type1" id="S46T49U594">s1</span>(:,:,<span class="var type1" id="S44T1U597">k</span>)</span> = <span class="mxinfo" id="T20:U447">(<span class="mxinfo" id="T1:U448"><span class="mxinfo" id="T1:U449">1</span>/<span class="mxinfo" id="T1:U450"><span class="var type1" id="S9T1U602">N0</span></span></span>).*(<span class="mxinfo" id="T20:U452"><span class="mxinfo" id="T20:U453"><span class="mxinfo" id="T20:U454">-<span class="var type1" id="S54T20U607">ax</span></span>*<span class="var type1" id="S33T20U608">D</span></span> + <span class="mxinfo" id="T20:U457"><span class="fcn" id="F554N10:B610">Done</span>(<span class="var type1" id="S44T1U611">k</span>,<span class="var type1" id="S24T46U612">x</span>,<span class="var type1" id="S20T2U613">t</span>,<span class="var type1" id="S19T2U614">gridT</span>,<span class="var type1" id="S13T45U615">f</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,128" id="srcline128">128</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,129" id="srcline129">129</a></span><span class="line">    <span class="comment">% components of Y</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,130" id="srcline130">130</a></span><span class="line">    <span class="mxinfo" id="T20:U463"><span class="var type1" id="S56T20U618">ay</span> = <span class="mxinfo" id="T20:U465">(<span class="mxinfo" id="T20:U466"><span class="var type1" id="S48T20U622">a1k</span>-<span class="mxinfo" id="T20:U468">(<span class="mxinfo" id="T1:U469">1/<span class="var type1" id="S8T1U627">alpha</span></span>)*(<span class="mxinfo" id="T20:U471"><span class="var type1" id="S50T20U630">b1k</span>+<span class="var type1" id="S52T20U631">b1s</span></span>)</span></span>)/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,131" id="srcline131">131</a></span><span class="line"><span class="mxinfo" id="T20:U463"><span class="mxinfo" id="T20:U465">         (<span class="mxinfo" id="T20:U474"><span class="var type1" id="S30T20U634">A</span>-<span class="mxinfo" id="T20:U476">(<span class="mxinfo" id="T1:U477">1/<span class="var type1" id="S8T1U639">alpha</span></span>)*(<span class="mxinfo" id="T20:U479"><span class="var type1" id="S31T20U642">B</span>+<span class="var type1" id="S32T20U643">Bstar</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,132" id="srcline132">132</a></span><span class="line">    <span class="mxinfo" id="T37:U482"><span class="mxinfo" id="T37:U483"><span class="var type1" id="S47T45U647">s2</span>(:,<span class="var type1" id="S44T1U649">k</span>)</span> = <span class="mxinfo" id="T37:U486"><span class="mxinfo" id="T45:U487">(<span class="mxinfo" id="T1:U488">1/<span class="var type1" id="S9T1U655">N0</span></span>)*(<span class="mxinfo" id="T45:U490"><span class="mxinfo" id="T45:U491"><span class="var type1" id="S56T20U659">ay</span>*<span class="var type1" id="S43T45U660">C</span></span>-<span class="mxinfo" id="T45:U494"><span class="fcn" id="F581N8:B662">Cone</span>(<span class="var type1" id="S24T46U663">x</span>,<span class="var type1" id="S23T47U664">gridX</span>,<span class="var type1" id="S20T2U665">t</span>)</span></span>)</span>*<span class="mxinfo" id="T48:U498"><span class="var type1" id="S15T46U667">u0</span>'</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="136,133" id="srcline133">133</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,135" id="srcline135">135</a></span><span class="line"><span class="mxinfo" id="T20:U500"><span class="var type1" id="S58T20U670">X</span> = <span class="mxinfo" id="T20:U502">sum(<span class="var type1" id="S46T49U673">s1</span>,3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,136" id="srcline136">136</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo" id="T37:U504"><span class="var type1" id="S60T37U677">Y</span> = <span class="mxinfo" id="T37:U506"><span class="mxinfo" id="T37:U507"><span class="var type1" id="S10T2U680">E</span>'</span>+<span class="mxinfo" id="T37:U509">sum(<span class="var type1" id="S47T45U683">s2</span>,2)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,138" id="srcline138">138</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo" id="T20:U511"><span class="var type1" id="S61T20U687">regTerm</span> = <span class="mxinfo" id="T20:U513"><span class="fcn" id="F367N11:B689">GetRegularizationTerm</span>(<span class="var type1" id="S11T1U690">N</span>,<span class="var type1" id="S5T1U691">regOrder</span>)</span></span>; <span class="comment">% get RregTerm= 'R term</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,140" id="srcline140">140</a></span><span class="line"><span class="comment">% The source solution with regularization coefficient lambda is</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo" id="T37:U516"><span class="var type1" id="S3T37U694">r</span>   = <span class="mxinfo" id="T37:U518">(<span class="mxinfo" id="T20:U519"><span class="mxinfo" id="T20:U520">(<span class="mxinfo" id="T20:U521"><span class="var type1" id="S58T20U701">X</span>'</span>)*<span class="var type1" id="S58T20U702">X</span></span>+<span class="mxinfo" id="T20:U524"><span class="var type1" id="S6T1U704">lambda</span>*<span class="var type1" id="S61T20U705">regTerm</span></span></span>)\(<span class="mxinfo" id="T37:U527"><span class="mxinfo" id="T20:U528"><span class="var type1" id="S58T20U709">X</span>'</span>*<span class="var type1" id="S60T37U710">Y</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,143" id="srcline143">143</a></span><span class="line"><span class="comment">% Calculate the solution u(x,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,144" id="srcline144">144</a></span><span class="line"><span class="mxinfo" id="T46:U531"><span class="var type1" id="S63T46U713">eta</span>     = <span class="mxinfo" id="T46:U533">ones(<span class="mxinfo" id="T1:U534">1</span>,<span class="mxinfo" id="T1:U535"><span class="var type1" id="S9T1U717">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,145" id="srcline145">145</a></span><span class="line"><span class="mxinfo" id="T1:U537"><span class="mxinfo" id="T1:U538"><span class="var type1" id="S63T46U721">eta</span>(<span class="mxinfo" id="T1:U540">1</span>)</span>  = <span class="mxinfo" id="T1:U541">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,146" id="srcline146">146</a></span><span class="line"><span class="mxinfo" id="T1:U542"><span class="mxinfo" id="T1:U543"><span class="var type1" id="S63T46U727">eta</span>(<span class="mxinfo" id="T1:U545"><span class="var type1" id="S9T1U728">N0</span></span>)</span> = <span class="mxinfo" id="T1:U547">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo" id="T45:U548"><span class="var type1" id="S2T45U732">u</span>       = <span class="mxinfo" id="T45:U550">zeros(<span class="var type1" id="S11T1U735">N</span>,<span class="mxinfo" id="T1:U552"><span class="var type1" id="S9T1U736">N0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,148" id="srcline148">148</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T1U739">j</span>=<span class="mxinfo" id="T1:U555">1</span>:<span class="var type1" id="S9T1U742">N0</span>    <span class="comment">% space index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,149" id="srcline149">149</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S35T1U745">i</span>=<span class="mxinfo" id="T1:U558">1</span>:<span class="var type1" id="S11T1U748">N</span> <span class="comment">% time index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,150" id="srcline150">150</a></span><span class="line">        <span class="mxinfo" id="T1:U560"><span class="var type1" id="S64T1U751">sTime</span>   = <span class="mxinfo" id="T1:U562">0</span></span>;<span class="comment">% cumulative sums</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,151" id="srcline151">151</a></span><span class="line">        <span class="mxinfo" id="T1:U563"><span class="var type1" id="S65T1U755">sSpace</span>  = <span class="mxinfo" id="T1:U565">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,152" id="srcline152">152</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S66T1U759">stIdx</span> = <span class="mxinfo" id="T1:U567">1</span>:<span class="var type1" id="S11T1U762">N</span> <span class="comment">% time index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,154" id="srcline154">154</a></span><span class="line">            <span class="mxinfo" id="T1:U569"><span class="var type1" id="S64T1U765">sTime</span> = <span class="mxinfo" id="T1:U571"><span class="mxinfo" id="T1:U572"><span class="mxinfo" id="T1:U573"><span class="mxinfo" id="T1:U574"><span class="mxinfo" id="T1:U575"><span class="var type1" id="S64T1U771">sTime</span>+ <span class="mxinfo" id="T1:U577"><span class="mxinfo" id="T1:U578"><span class="fcn" id="F1N2:B774">Acoeff</span>(<span class="mxinfo" id="T1:U579">0</span>,<span class="var type1" id="S66T1U776">stIdx</span>,<span class="mxinfo" id="T1:U581"><span class="var type1" id="S24T46U778">x</span>(<span class="var type1" id="S34T1U779">j</span>)</span>,<span class="mxinfo" id="T1:U584"><span class="var type1" id="S20T2U781">t</span>(<span class="var type1" id="S35T1U782">i</span>)</span>,<span class="var type1" id="S19T2U783">gridT</span>)</span>*<span class="mxinfo" id="T1:U588"><span class="var type1" id="S28T37U785">q0j</span>(<span class="var type1" id="S66T1U786">stIdx</span>)</span></span></span> + <span class="mxinfo" id="T1:U591"><span class="mxinfo" id="T1:U592"><span class="fcn" id="F1N2:B789">Acoeff</span>(<span class="mxinfo" id="T1:U593">1</span>,<span class="var type1" id="S66T1U791">stIdx</span>,<span class="mxinfo" id="T1:U595"><span class="var type1" id="S24T46U793">x</span>(<span class="var type1" id="S34T1U794">j</span>)</span>,<span class="mxinfo" id="T1:U598"><span class="var type1" id="S20T2U796">t</span>(<span class="var type1" id="S35T1U797">i</span>)</span>, <span class="var type1" id="S19T2U798">gridT</span>)</span>*<span class="mxinfo" id="T1:U602"><span class="var type1" id="S29T37U800">q1j</span>(<span class="var type1" id="S66T1U801">stIdx</span>)</span></span></span>-<span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo" id="T1:U569"><span class="mxinfo" id="T1:U571"><span class="mxinfo" id="T1:U572"><span class="mxinfo" id="T1:U573">                <span class="mxinfo" id="T1:U605"><span class="mxinfo" id="T1:U606"><span class="fcn" id="F75N4:B804">Bcoeff</span>(<span class="mxinfo" id="T1:U607">0</span>,<span class="var type1" id="S66T1U806">stIdx</span>,<span class="mxinfo" id="T1:U609"><span class="var type1" id="S24T46U808">x</span>(<span class="var type1" id="S34T1U809">j</span>)</span>,<span class="mxinfo" id="T1:U612"><span class="var type1" id="S20T2U811">t</span>(<span class="var type1" id="S35T1U812">i</span>)</span>,<span class="var type1" id="S19T2U813">gridT</span>)</span>*<span class="mxinfo" id="T1:U616"><span class="var type1" id="S26T37U815">h0j</span>(<span class="var type1" id="S66T1U816">stIdx</span>)</span></span></span> - <span class="mxinfo" id="T1:U619"><span class="mxinfo" id="T1:U620"><span class="fcn" id="F75N4:B819">Bcoeff</span>(<span class="mxinfo" id="T1:U621">1</span>,<span class="var type1" id="S66T1U821">stIdx</span>,<span class="mxinfo" id="T1:U623"><span class="var type1" id="S24T46U823">x</span>(<span class="var type1" id="S34T1U824">j</span>)</span>,<span class="mxinfo" id="T1:U626"><span class="var type1" id="S20T2U826">t</span>(<span class="var type1" id="S35T1U827">i</span>)</span>, <span class="var type1" id="S19T2U828">gridT</span>)</span>*<span class="mxinfo" id="T1:U630"><span class="var type1" id="S27T37U830">h1j</span>(<span class="var type1" id="S66T1U831">stIdx</span>)</span></span></span>+<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo" id="T1:U569"><span class="mxinfo" id="T1:U571">                <span class="mxinfo" id="T1:U633"><span class="mxinfo" id="T1:U634"><span class="fcn" id="F454N9:B834">Dcoeff</span>(<span class="var type1" id="S24T46U835">x</span>,<span class="var type1" id="S66T1U836">stIdx</span>,<span class="mxinfo" id="T1:U637"><span class="var type1" id="S24T46U838">x</span>(<span class="var type1" id="S34T1U839">j</span>)</span>,<span class="mxinfo" id="T1:U640"><span class="var type1" id="S20T2U841">t</span>(<span class="var type1" id="S35T1U842">i</span>)</span>,<span class="var type1" id="S19T2U843">gridT</span>,<span class="mxinfo" id="T46:U644"><span class="var type1" id="S13T45U845">f</span>(<span class="var type1" id="S35T1U846">i</span>,:)</span>)</span>*<span class="mxinfo" id="T1:U647"><span class="var type1" id="S3T37U849">r</span>(<span class="var type1" id="S66T1U850">stIdx</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,157" id="srcline157">157</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,158" id="srcline158">158</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,159" id="srcline159">159</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S67T1U853">ssIdx</span> = <span class="mxinfo" id="T1:U651">1</span>:<span class="var type1" id="S9T1U856">N0</span> <span class="comment">% space index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,160" id="srcline160">160</a></span><span class="line">            <span class="mxinfo" id="T1:U653"><span class="var type1" id="S65T1U859">sSpace</span> = <span class="mxinfo" id="T1:U655"><span class="var type1" id="S65T1U861">sSpace</span> +<span class="mxinfo" id="T1:U657"><span class="mxinfo" id="T1:U658"><span class="fcn" id="F654N7:B864">Ccoeff</span>(<span class="var type1" id="S67T1U865">ssIdx</span>,<span class="mxinfo" id="T1:U660"><span class="var type1" id="S24T46U867">x</span>(<span class="var type1" id="S34T1U868">j</span>)</span>,<span class="mxinfo" id="T1:U663"><span class="var type1" id="S20T2U870">t</span>(<span class="var type1" id="S35T1U871">i</span>)</span>,<span class="var type1" id="S19T2U872">gridT</span>)</span>*<span class="mxinfo" id="T1:U667"><span class="var type1" id="S15T46U874">u0</span>(<span class="var type1" id="S67T1U875">ssIdx</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,161" id="srcline161">161</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,162" id="srcline162">162</a></span><span class="line">        <span class="mxinfo" id="T1:U670"><span class="mxinfo" id="T1:U671"><span class="var type1" id="S2T45U879">u</span>(<span class="var type1" id="S35T1U880">i</span>,<span class="var type1" id="S34T1U881">j</span>)</span> = <span class="mxinfo" id="T1:U675">(<span class="mxinfo" id="T1:U676"><span class="var type1" id="S64T1U885">sTime</span>+<span class="var type1" id="S65T1U886">sSpace</span></span>)*<span class="mxinfo" id="T1:U679"><span class="var type1" id="S63T46U888">eta</span>(<span class="var type1" id="S34T1U889">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,164" id="srcline164">164</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,165" id="srcline165">165</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U682">all(<span class="var type1" id="S7T3U894">plotFlag</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,166" id="srcline166">166</a></span><span class="line"><span class="fcn" id="F664N12:B897">PlotResults</span>(<span class="var type1" id="S20T2U898">t</span>,<span class="var type1" id="S4T2U899">sigIn</span>,<span class="var type1" id="S2T45U900">u</span>,<span class="var type1" id="S3T37U901">r</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="136,167" id="srcline167">167</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,168" id="srcline168">168</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
