function DiffuseOnSphere
% random walk on a sphere assuming the directions are indipendent
close all
numSteps       = 100;
radius         = 1;
dt             = 0.001;
diffusionConst = 1;
w              = sqrt(2*diffusionConst*dt)/radius;

[sx,sy,sz]  = sphere(20);
sx          = sx*radius;
sy          = sy*radius;
sz          = sz*radius;

% random angle sampling for points on the sphere
u     = rand(1);
v     = rand(1);
phi   = pi/4;%2*pi*u;
theta = pi/4;%acos(2*v -1);

dTheta      = RandomWrappedNormalOnCircle(0,1,numSteps-1,-2*pi:.1:2*pi);
dPhi        = RandomWrappedNormalOnCircle(0,1,numSteps-1,-2*pi:.1:2*pi);
theta       = (cumsum([theta;w*dTheta]));
phi         = (cumsum([phi;w*dPhi]));
figure, subplot(141),plot(phi),set(gca,'YLim',[-2*pi 2*pi]), title('phi'), 
        subplot(142), plot(theta),set(gca,'YLim',[-2*pi 2*pi]), title('theta')
        x = xcorr(theta,phi);
        subplot(143), plot(x./sum(x))
        dx = xcorr(dTheta
% theta = cumsum([theta;tt]);
% phi  =  cumsum([phi;pp]);
x           = radius*sin(phi).*cos(theta);
y           = radius*sin(phi).*sin(theta);
z           = radius*cos(phi);
points      = [x,y,z];
% for sIdx = 2:numSteps
%     
%     theta = theta+w*RandomWrappedNormalOnCircle(0,1,1);
%     phi   = phi+w*RandomWrappedNormalOnCircle(0,1,1);
% 
%     x     = radius*sin(phi)*cos(theta);
%     y     = radius*sin(phi)*sin(theta);
%     z     = radius*cos(phi);
%     points(sIdx,:)= [x,y,z];    
% end

figure, plot(theta,phi), xlabel('\theta'), ylabel('\phi')
figure, mesh(sx,sy,sz,'FaceColor','none','EdgeColor','g'), hold on, 
% color = jet(numSteps);
plot3(points(:,1), points(:,2),points(:,3))
line('XData',[0 radius*sin(phi(1)).*cos(theta(1))],...
     'YData',[0 radius*sin(phi(1)).*sin(theta(1))],...
     'ZData',[0 radius*cos(phi(1))],...
     'Color','r')
% for i = 1:numSteps-1;
%     line('XData',[points(i,1),points(i+1,1)],'YData',[points(i,2),points(i+1,2)],'ZData',[points(i,3),points(i+1,3)],'Color',color(i,:),'Parent',gca)
% end
cameratoolbar
daspect([1 1 1])

end